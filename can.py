import socket
from time import sleep

HOST = '192.168.16.100'
PORT = 6801

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

def connect_can():
    try:
        sock.connect((HOST, PORT))
        print("Connected to ENET adapter")
    except socket.error as error:
        print(error)

def send_can_message():
    try:
        msgs = [
            [0x00, 0x00, 0x00, 0x04, 0x00, 0x01, 0xf4, 0x43, 0x10, 0x03],
            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x43, 0x31, 0x01, 0xa5, 0x43, 0x02],
            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x43, 0x31, 0x02, 0xa5, 0x43, 0x02],

            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x43, 0x31, 0x01, 0xa5, 0x43, 0x03],
            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x43, 0x31, 0x02, 0xa5, 0x43, 0x03],

            [0x00, 0x00, 0x00, 0x04, 0x00, 0x01, 0xf4, 0x44, 0x10, 0x03],
            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x44, 0x31, 0x01, 0xa5, 0x43, 0x02],
            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x44, 0x31, 0x02, 0xa5, 0x43, 0x02],

            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x44, 0x31, 0x01, 0xa5, 0x43, 0x03],
            [0x00, 0x00, 0x00, 0x07, 0x00, 0x01, 0xf4, 0x44, 0x31, 0x02, 0xa5, 0x43, 0x03],
            ]
        for _ in range(0, 1000):
            for i, msg in enumerate(msgs):
                sock.send(bytearray(msg))
                if i != 0 and i != 5:
                    sleep(0.05)
                print(f"Send: {msg}")
    except socket.error as error:
        print(error)

def read_can_message():
    try:
        data = sock.recv(1024)
        print(f"Received: {data}")
    except socket.error as error:
        print(error)

def main():
    connect_can()
    print("1 - Send message\n2 - Read message")
    while True:
        num = int(input())
        match num:
            case 1: send_can_message()
            case 2: read_can_message()
            case _: exit()

main()